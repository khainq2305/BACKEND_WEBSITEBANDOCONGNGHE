require('dotenv').config();
const { PostSEO } = require('./src/models');

async function createPostSEOTable() {
  try {
    console.log('Đang tạo bảng post_seo...');
    
    // Tạo bảng nếu chưa tồn tại
    await PostSEO.sync({ force: false });
    
    console.log('✅ Bảng post_seo đã được tạo thành công!');
    
    // Tạo một số dữ liệu mẫu (tùy chọn)
    const sampleData = {
      postId: 1, // Giả sử có post với ID = 1
      seoTitle: 'Tiêu đề SEO mẫu - Tối ưu cho tìm kiếm',
      metaDescription: 'Mô tả meta mẫu cho bài viết, tối ưu SEO với độ dài phù hợp từ 120-160 ký tự để hiển thị tốt trên kết quả tìm kiếm.',
      focusKeywords: ['SEO', 'tối ưu tìm kiếm', 'marketing'],
      canonicalUrl: 'https://yoursite.com/sample-post',
      ogTitle: 'Tiêu đề Open Graph',
      ogDescription: 'Mô tả Open Graph cho mạng xã hội',
      ogImage: 'https://yoursite.com/images/og-image.jpg',
      twitterTitle: 'Tiêu đề Twitter Card',
      twitterDescription: 'Mô tả Twitter Card',
      twitterImage: 'https://yoursite.com/images/twitter-image.jpg',
      seoScore: 85,
      autoGenerateTitle: true,
      autoGenerateDescription: true
    };
    
    // Kiểm tra xem đã có dữ liệu mẫu chưa
    const existingSample = await PostSEO.findOne({ where: { postId: 1 } });
    if (!existingSample) {
      console.log('Đang tạo dữ liệu mẫu...');
      await PostSEO.create(sampleData);
      console.log('✅ Dữ liệu mẫu đã được tạo!');
    } else {
      console.log('ℹ️ Dữ liệu mẫu đã tồn tại');
    }
    
    console.log('\n🎉 Thiết lập PostSEO hoàn tất!');
    console.log('\nCác API endpoint có sẵn:');
    console.log('- GET /admin/post-seo/posts - Lấy danh sách posts với SEO');
    console.log('- GET /admin/post-seo/posts/:postId - Lấy thông tin SEO của post');
    console.log('- PUT /admin/post-seo/posts/:postId - Cập nhật SEO của post');
    console.log('- POST /admin/post-seo/posts/:postId/analyze - Phân tích SEO');
    console.log('- GET /admin/post-seo/stats - Thống kê SEO');
    
  } catch (error) {
    console.error('❌ Lỗi khi tạo bảng post_seo:', error);
  } finally {
    process.exit();
  }
}

createPostSEOTable();
